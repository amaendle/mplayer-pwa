<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#111111" />
  <title>MP3 Tiles Player</title>
  <style>
    :root { --bg:#0f0f10; --fg:#f2f2f2; --mut:#a7a7a7; --card:#19191b; --line:#2a2a2f; }
    * { box-sizing:border-box; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    body { margin:0; background:var(--bg); color:var(--fg); }
    header { position:sticky; top:0; z-index:2; background:rgba(15,15,16,.9); backdrop-filter: blur(8px);
      border-bottom:1px solid var(--line); padding:12px 14px; display:flex; gap:10px; align-items:center; }
    header h1 { font-size:16px; margin:0; flex:1; }
    header button { background:var(--card); color:var(--fg); border:1px solid var(--line);
      padding:8px 10px; border-radius:12px; cursor:pointer; }
    header button:active { transform: translateY(1px); }

    .wrap { padding:14px 14px 96px; }
    .status { color:var(--mut); font-size:13px; margin:8px 0 14px; }

    .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap:12px; }
    .tile { background:var(--card); border:1px solid var(--line); border-radius:18px; overflow:hidden; cursor:pointer; }
    .tile.playLaterTile { outline:1px dashed var(--line); }
    .tile.playLaterTile .cover { background:#26263a; color:#f9f9f9; font-size:28px; }
    .cover { width:100%; aspect-ratio:1/1; background:#2a2a2f; display:flex; align-items:center; justify-content:center; color:var(--mut); }
    .meta { padding:10px; }
    .album { font-weight:650; font-size:14px; margin:0 0 3px; }
    .artist { color:var(--mut); font-size:12px; margin:0; }

    /* Library drawer */
    .drawer {
      position:fixed; inset:0; z-index:5; display:none;
      background:rgba(0,0,0,.45);
    }
    .drawer.open { display:block; }
    .panel {
      position:absolute; left:0; top:0; height:100%; width:min(360px, 88vw);
      background:var(--bg); border-right:1px solid var(--line); padding:14px;
    }
    .panel h2 { margin:6px 0 10px; font-size:16px; }
    .panel .small { color:var(--mut); font-size:12px; }
    .panel button { width:100%; margin-top:12px; padding:10px 12px; border-radius:14px;
      background:var(--card); color:var(--fg); border:1px solid var(--line); cursor:pointer; }
    .panel .modeRow { display:flex; align-items:center; justify-content:space-between; gap:10px; margin:10px 0 4px; }
    .panel .modeRow .pill { width:auto; min-width:90px; padding:10px 12px; border-radius:999px; }

    /* Player bar */
    .player {
      position:fixed; left:0; right:0; bottom:0; z-index:8;
      border-top:1px solid var(--line);
      background:rgba(25,25,27,.92); backdrop-filter: blur(10px);
      padding:10px 12px;
      display:flex; gap:10px; align-items:center;
    }
    .now { flex:1; min-width:0; }
    .now .t { font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .now .s { color:var(--mut); font-size:12px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    .controls { display:flex; gap:8px; }
    .controls button {
      width:44px; height:44px; border-radius:14px;
      background:var(--card); color:var(--fg); border:1px solid var(--line);
      cursor:pointer; font-size:16px;
    }

    /* Album tile play overlay */
    .tile { position: relative; }
    .playOverlay {
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      background: linear-gradient(to top, rgba(0,0,0,.65), rgba(0,0,0,.15));
      opacity:0; transition: opacity .12s ease;
    }
    .tile:active .playOverlay, .tile:hover .playOverlay { opacity:1; }
    .playBtn {
      width:64px; height:64px; border-radius:999px;
      border:1px solid var(--line);
      background:rgba(25,25,27,.92);
      display:flex; align-items:center; justify-content:center;
      font-size:26px;
    }
    
    /* Fullscreen Now Playing */
    .nowView {
      position:fixed; inset:0; z-index:6;
      background:var(--bg);
      display:none;
      padding:16px 16px 140px;
      overflow-y:auto;
    }
    .nowView.open { display:block; }
    .bigCover {
      margin-top:14px;
      width:min(420px, 92vw);
      aspect-ratio:1/1;
      border-radius:22px;
      overflow:hidden;
      border:1px solid var(--line);
      background:#2a2a2f;
      display:flex; align-items:center; justify-content:center;
      position:relative;
      touch-action: pan-y;
    }
    .bigCover img { width:100%; height:100%; object-fit:cover; display:block; }

    .coverSlider { position:absolute; inset:0; }
    .coverSlider img { position:absolute; inset:0; opacity:0; transition: opacity .5s ease; }
    .coverSlider img.active { opacity:1; }
    
    .bigTitle { margin:14px 0 4px; font-size:20px; font-weight:750; }
    .bigSub { margin:0 0 16px; color:var(--mut); }
    
    .bigControls { display:flex; gap:10px; }
    .bigControls button {
      flex:1;
      height:64px;
      border-radius:18px;
      background:var(--card);
      color:var(--fg);
      border:1px solid var(--line);
      font-size:22px;
      cursor:pointer;
    }

    /* Easy access layout tweaks */
    body.easy-access .wrap { padding-bottom:160px; }
    body.easy-access .grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap:16px; }
    body.easy-access .tile { border-radius:22px; }
    body.easy-access .player { display:none; }
    .easyPlayer {
      display:none;
      position:fixed; left:0; right:0; bottom:0; z-index:8;
      padding:16px;
      background:rgba(25,25,27,.96);
      border-top:1px solid var(--line);
      box-shadow:0 -6px 24px rgba(0,0,0,.35);
    }
    body.easy-access .easyPlayer { display:block; }
    .easyPlayer .bigTitle { margin:0 0 4px; }
    .easyPlayer .bigControls button { height:72px; font-size:24px; }

    body.easy-access .nowView { padding-bottom:220px; }

    /* Now Playing album preview strip */
    .nowAlbumPreview {
      margin-top:12px;
      padding:8px 10px;
      border-radius:16px;
      border:1px solid var(--line);
      background:var(--card);
      display:flex;
      flex-wrap:nowrap;
      gap:8px;
      overflow:hidden;
      cursor:pointer;
      align-items:center;
    }
    .nowAlbumPreview .thumb {
      width:52px;
      height:52px;
      flex:0 0 auto;
      border-radius:12px;
      overflow:hidden;
      background:#2a2a2f;
      display:flex;
      align-items:center;
      justify-content:center;
      color:var(--mut);
      font-size:12px;
    }
    .nowAlbumPreview .thumb img {
      width:100%; height:100%; object-fit:cover; display:block;
    }

    /* Tracklist */
    .tracklist {
      margin-top:12px;
      padding:10px;
      border-radius:16px;
      border:1px solid var(--line);
      background:var(--card);
    }
    .albumActions {
      display:flex;
      gap:8px;
      margin:6px 0 12px;
    }
    .albumActions button {
      flex:1;
      padding:10px;
      border-radius:12px;
      border:1px solid var(--line);
      background:var(--card);
      color:var(--fg);
      cursor:pointer;
      font-weight:650;
    }
    .albumActions button.primary {
      background:linear-gradient(135deg, #3c82ff, #7c4dff);
      border-color:transparent;
      color:white;
    }
    .trackRows { display:flex; flex-direction:column; gap:4px; }
    .trackRow {
      width:100%;
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 8px;
      border-radius:12px;
      border:1px solid transparent;
      background:none;
      color:inherit;
      text-align:left;
      cursor:pointer;
    }
    .trackRow .num { width:28px; color:var(--mut); font-variant-numeric: tabular-nums; }
    .trackRow .meta { flex:1; min-width:0; }
    .trackRow .meta .title { font-weight:650; font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .trackRow .meta .artist { color:var(--mut); font-size:12px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .trackRow .state { width:18px; text-align:right; color:var(--mut); }
    .trackRow.active { border-color:var(--line); background:rgba(255,255,255,.04); }
    .trackRow .actions { display:flex; gap:6px; }
    .trackRow .actions button {
      padding:6px 8px;
      border-radius:8px;
      border:1px solid var(--line);
      background:var(--card);
      color:var(--fg);
      cursor:pointer;
      font-size:12px;
      white-space:nowrap;
    }
  </style>
</head>
<body>
  <header>
    <h1>MP3 Tiles Player</h1>
    <button id="btnLibrary">Library</button>
  </header>

  <div class="wrap">
    <div class="status" id="status">Click ‚ÄúAdd Music‚Äù to add music to the library.</div>
    <div class="grid" id="grid"></div>
  </div>

  <!-- Drawer -->
  <div class="drawer" id="drawer" aria-hidden="true">
    <div class="panel">
      <h2>Library</h2>
      <div class="small" id="libInfo">No folder connected yet.</div>
      <div class="modeRow">
        <div>
          <div class="small">Rebuild speed</div>
          <div class="small" id="rebuildModeDesc">Fast rebuild (default)</div>
        </div>
        <button id="btnToggleRebuildMode" class="pill">Fast</button>
      </div>
      <div class="modeRow">
        <div>
          <div class="small">Easy access mode</div>
          <div class="small">Larger tiles and big controls</div>
        </div>
        <button id="btnToggleEasyAccess" class="pill">Off</button>
      </div>
      <button id="btnReconnect">Reconnect / Request Permission</button>
      <button id="btnConnect">Add Music</button>
      <button id="btnClearLibrary">Remove all folders</button>
      <button id="btnCloseDrawer">Close</button>
    </div>
  </div>

  <!-- Fullscreen Now Playing -->
  <div class="nowView" id="nowView" aria-hidden="true">
    <div class="nowAlbumPreview" id="nowAlbumPreview" title="Show albums"></div>

    <div class="bigCover" id="bigCover">Cover</div>
  
    <div class="bigTitle" id="bigTitle">Nothing playing</div>
    <div class="bigSub" id="bigSub">Pick an album</div>
  
    <div class="tracklist" id="tracklist" aria-label="Album tracklist"></div>
  </div>

  <div class="easyPlayer" id="easyPlayer" aria-live="polite">
    <div class="bigTitle" id="easyBigTitle">Nothing playing</div>
    <div class="bigSub" id="easyBigSub">Pick an album tile</div>
    <div class="bigControls">
      <button id="btnEasyPrev">‚èÆ</button>
      <button id="btnEasyPlay">‚èØ</button>
      <button id="btnEasyNext">‚è≠</button>
    </div>
  </div>

  <!-- Player bar -->
  <div class="player">
    <div class="now">
      <div class="t" id="nowTitle">Nothing playing</div>
      <div class="s" id="nowSub">Select an album tile</div>
    </div>
    <div class="controls">
      <button id="btnPrev" title="Previous">‚èÆ</button>
      <button id="btnPlay" title="Play/Pause">‚èØ</button>
      <button id="btnNext" title="Next">‚è≠</button>
      <button id="btnToggleLibrary" title="Open/Close Library">üìö</button>
    </div>
  </div>

  <script src="./vendor/jsmediatags.min.js"></script>
  <script type="module" src="app.js"></script>
</body>
</html>
